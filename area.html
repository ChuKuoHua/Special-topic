<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>無標題文件</title>

    <link rel="stylesheet" type="text/css" href="css/button.css">
    <link rel="stylesheet" type="text/css" href="css/switch.css">
    <link rel="stylesheet" type="text/css" href="css/slider.css">
    <link rel="stylesheet" type="text/css" href="css/div.css">

    <style type="text/css">
        body {
            background-image: url(image/areabkg.png);
            background-repeat: no-repeat;
            background-size: 90%;
            background-position: center;
            background-position-y: 10px;
        }
        
        #th1 {
            color: blue;
            font-family: DFKai-sb;
            font-size: 18px;
        }
        
        #th2 {
            color: red;
            font-family: DFKai-sb;
            font-size: 18px;
        }
        
        tbody,
        th {
            font-size: 20px;
            position: relative;
        }
        
        td {
            font-size: 18px;
            position: relative;
            right: 12px;
            left: 25px;
            color: #000
        }
    </style>

    <!--環境判斷-->
    <script>
        function Status(name, value) {
            var x = value;
            switch (name) {
                case 'temp':
                    $('td.tempStatus').html('');
                    if (x > 40 || x < 0) {
                        $('td.tempStatus').append('<font color=red  >異常</font>');
                    } else {
                        $('td.tempStatus').append('<font color=green>正常</font>');

                    }
                    break;
                case 'ph':
                    $('td.phStatus').html('');
                    if (x > 12 || x < 3) {
                        $('td.phStatus').append('<font color=red >異常</font>');

                    } else {
                        $('td.phStatus').append('<font color=green >正常</font>');

                    }
                    break;
            }


        }
    </script>
</head>

<body>
    <!---外部區塊-->
    <div style=" height: 808px; width: 100%; margin: 0 auto;border:0px black solid;">

        <!--主要區塊 -->
        <div id="a" style="height: 68px; width: 67%;margin:52px 0px 0px 30%;border:0px black solid;">

            <!--首頁-->
            <div id="home-area">
                <center>
                    <ul class="Exa1">
                        <li>
                            <a class="button-home2" href="#" onClick="location.href ='home.html'">
                            </a>
                        </li>
                        <!--設備管理-->
                        <li>
                            <a class="button-set2" href="#" onClick="location.href ='area.html'">
                            </a>
                        </li>
                        <!--歷史資料-->
                        <li>
                            <a class="button-his2" href="#" onClick="location.href ='history.html'">
                            </a>
                        </li>
                    </ul>
                </center>
            </div>

        </div>

        <div style="height:500px;margin:0px 0px 0px 0px;float:left;width:100%;border:0px black solid;">

            <!--環境感測資訊區塊 -->
            <div id="enmt-area">
                <font face="Comic Sans MS, cursive">
                    <div class="panel panel-primary">

                        <div class="panel-body">
                            <table width="100%" height="88" class="table table-hover1" style="margin-bottom:0;">
                                <thead>
                                    <tr>
                                        <th width="50%"></th>
                                        <th width="50%"></th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>

            </div>
            <!--end.panel-->

            <!---控制區塊-->
            <div id="a" style="height:680px; border:0px black solid; margin:50px 60px 0px 40px; float:right; width:65%;">

                <!--溫度上下限-->
                <div id="divtp-area">

                    <table width="100%" height="65" class="slider" style="margin-bottom:0;">
                        <thead>
                            <tr>
                                <th id="th1" width="10%" height="61">下限</th>
                                <th width="20%">
                                    <select id="soflow" class="tpmin">            
									<option value="26">26</option>
									<option value="25">25</option>
									<option value="24">24</option>
									<option value="23">23</option>
									<option value="22">22</option>
									<option value="21">21</option>
									<option value="20">20</option>
									<option value="19">19</option>
									<option value="18">18</option>
								</select>
                                </th>
                                <th id="th2" width="10%">上限</th>
                                <th width="20%">
                                    <select id="soflow" class="tpmax">
									<option value="27">27</option>    	 
									<option value="28">28</option>
									<option value="29">29</option>
									<option value="30">30</option>
									<option value="31">31</option>
									<option value="32">32</option>
									<option value="33">33</option>
									<option value="34">34</option>
									<option value="35">35</option>
								</select>
                                </th>
                                <th width="30%">
                                    <button class="temp" value="Submit" id="temp" style="cursor: pointer;" onClick=control "6", "temp"><b>確定</b></button>
                                </th>
                            </tr>
                        </thead>
                    </table>
                </div>


                <!--溫度上下限end-->
                <!--ph上下限-->
                <div id="divph-area">
                    <table width="100%" height="15" class="slider" style="margin-bottom:0;">
                        <thead>
                            <tr>
                                <th id="th1" width="10%">下限</th>
                                <th width="20%">
                                    <select id="soflow" class="phmin"> 
					<option value="7">7</option>
					<option value="6">6</option>
					<option value="5">5</option>
					<option value="4">4</option>
					<option value="3">3</option>
					<option value="2">2</option>
					<option value="1">1</option>
				</select>
                                </th>
                                <th id="th2" width="10%">上限</th>

                                <th width="20%">
                                    <select id="soflow" class="phmax"> 
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
				</select>
                                </th>
                                <th width="30%">
                                    <button class="ph" value="Submit" id="ph" style="cursor: pointer;" onClick=control "A0", "ph"><b>確定</b></button>
                                </th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <!--ph上下限end-->
                <!--電器開關-->
                <div id="power-area">
                    <table width="95%" class="table table-hover" style="margin-bottom:0;border:0px black solid;">
                        <thead>
                            <tr>
                                <th width="20%"></th>
                                <th width="20%"><br><br>


                                    <div class="onoffswitch1" style="margin:-30px 0px 0px 0px;">
                                        <input type="checkbox" name="onoffswitch" id="myonoffswitch" checked class="onoffswitch-checkbox" onClick=control "3", "feed";>
                                        <label for="myonoffswitch" class="onoffswitch-label">
						<span class="onoffswitch-inner" ></span>
						<span class="onoffswitch-switch" ></span>
					</label>

                                    </div>
                                </th>
                                <th width="5%"></th>
                                <th width="10%"><br>
                                    <select id="soflow" class="timing"> 
								<option value="8">8hr</option>
								<option value="12">12hr</option>
								<option value="24">24hr</option>  			
							</select>
                                </th>
                                <th width="10%"><br>

                                    <button class="ft" value="Submit" style="cursor: pointer;" id="timing" onClick=control "tu", "timing"><b>確定</b></button>

                                </th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <!--電器開關end-->
                <!--設備狀態-->
                <div id="a1-area">
                    <table width="90%" height="100" class="table table-hover" style="margin-bottom:0;border:0px black solid;">
                        <thead>
                            <tr>
                                <th width="5%"></th>
                                <td width="30%" class="tempStatus" style="font-family:Comic Sans MS, cursive;"></td>
                                <th width="10%"></th>
                                <td width="25%" class="phStatus" style="font-family:Comic Sans MS, cursive;"></td>
                            </tr>
                        </thead>
                    </table>
                </div>
                <!--設備狀態end-->
            </div>
            <!---控制區塊end-->
        </div>
    </div>
    <!---外部區塊end-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

    <script src="//code.jquery.com/jquery-1.11.3.min.js">
    </script>
    <script>
        $(function() {
            $.post('api.php', {
                action: 'getSensor'
            }, function(data) {
                for (var i in data) {

                    $('table:eq(0) tbody').append(
                        $('<tr/>').append(
                            $('<th/>').text(data[i].ch_name)),
                        $('<tr/>').append(
                            $('<th/>').text(data[i].value).addClass('value'),
                            $('<td/>').text(data[i].datetime).addClass('time')
                        ),
                        $('<br/>').append(),
                        $('<br/>').append()
                        .addClass(data[i].name)
                    )
                    Status(data[i].name, data[i].value);
                }
            }, 'json');
            setInterval(function() {
                $.post('api.php', {
                    action: 'getSensor'
                }, function(data) {
                    for (var i in data) {
                        $('table:eq(0) tbody tr.' + data[i].name + ' td.value').text(data[i].value);
                        $('table:eq(0) tbody tr.' + data[i].name + ' td.time').text(data[i].datetime);
                        Status(data[i].name, data[i].value);
                    }
                }, 'json');
            }, 60000);

        });

        //控制繼電器
        function control(cmd, type) {
            switch (type) { //判斷switch
                case 'temp':
                    //取temp上下限值
                    cmd = 'tp:' + $("select.tpmin").val() + ',' + $("select.tpmax").val();
                    break;
                case 'ph':
                    //取ph上下限值
                    cmd = 'ph:' + $("select.phmin").val() + ',' + $("select.phmax").val();
                    break;

                case 'feed':
                    var status3 = $("#myonoffswitch").prop("checked");

                    if (status3) {
                        cmd += ',H';
                    } else {
                        cmd += ',L';
                    }
                    break;

                case 'timing':
                    cmd = 'timing:' + $("select.timing").val();
                    break;
            }
            console.log(cmd);
            $.post('action.php', {
                cmd: cmd
            });
        }
    </script>
</body>

</html>